# プロジェクト概要

このプロジェクトでは、 Claude, Codex の2つのAIが共同でブラウザゲームを開発するものです。
各AIへの指示は「README.md を読んで進めてください」だけとします。

# 作るもの

ブラウザ上で動く横スクロールジャンプアクションゲームです。
スーパーマリオブラザーズのようなものを目指します。
アクション性、操作性、ビジュアル、敵キャラクター、ステージなどゲームとしての完成度を上げるように工夫してください。

ブラウザで動くものとして、 HTML, CSS, JavaScript もしくは TypeScript を使って実装してください。
また、WebGLは使わないでください。
index.html をブラウザで開くだけで遊べる状態にしてください。CSSやJavaScriptは外部ファイルを参照してください。

# 開発ルール

Claude → Codex → Claude → ... の順で開発を進めます。指示者（人間）が順番に指示をしていきます。
各AIは自分の番が来たら、README.md とコミットログを読んで、開発を進めてください。
他のAIが編集している可能性があるので、必ず最新のファイルを読み直してください。

開発内容や仕様は都度、 README.md に記載してください。時系列ではなく、現状をまとめ直す形でお願いします。
次につくるものなどはコミットメッセージでやりとりしてください。

コミットログを見ながら、相手の意図を理解したうえで、あえて意図を無視してでもゲームが面白くなる変更を加えてください。
相手の変更は尊重し、元に戻すということは避けてください。

# 役割

2つのAIにはそれぞれ役割を与えます。

Claude → ゲームとしての完成度、ゲームバランスを重視します
Codex → 革新性、プレイヤーへ驚きを与えることを重視します

# バージョン管理

Git でリポジトリ管理をしています。コミットログは以下のフォーマットで書いてください。

```
<AI名>: <変更内容の要約>
<前のコミットへの感想>
```

例：
```
Claude: 自機の移動部分を作成
Codexの実装はよいですが、アイデアはもっとふくらませる余地があります
```

コミットの粒度はなるべく小さく、1つのコミットで1つの機能を追加するようにしてください。
機能が完成しなくても次のAIに引き継いでもよいですが、自分のターンの終わりは必ずコミットして終わってください。

1コミットごとにバージョンを上げてください。バージョンは v0.1 から始めます。v0.9 の次は v0.10, v0.11 ... と続きます。
大きな変更があったと判断したときはメジャーバージョンを上げて、 v1.0, v2.0 ... としてください。

versions/v0.1/index.html のように、バージョンごとにディレクトリを分けて各バージョンをファイルとしても保存してください。
ルートディレクトリには　index.html や参照する外部ファイルの最新のセットを配置してください。

また、ルートディレクトリに changes.html を置いて、バージョンリストと、バージョンごとの主な変更点と、各バージョンのHTMLファイルへのリンクを貼ってください。

# 現在の実装状況

## バージョン: v0.18

## 実装済み機能

### 基本ゲームシステム
- Canvas を使った 2D レンダリング（800x600 viewport）
- **複数ステージシステム**（3ステージ構成）（v0.9）
- **ステージクリア＆進行システム**（タイムアタック、ランク評価）（v0.9）
- 横スクロールステージ（ステージごとに異なる幅）（v0.7, v0.9で拡張）
- カメラシステム（プレイヤー追従）（v0.7）
- ゴールシステム（ステージ終端到達でクリア）（v0.7）
- ゲームループ（requestAnimationFrame）
- 重力システム（SOLID: 0.5 / ETHER: 0.35）
- 物理演算（速度、加速度、摩擦）
- フェーズエネルギー（時間経過とオーブ取得で回復）
- 時限型フェーズパワーアップによる一時的な能力強化（v0.8）
- **動的ステージ生成**（ステージサイズに応じた配置自動生成）（v0.9）
- **Apex Resonance フュージョン**（SURGE+STORM同時発動で共鳴モード突入、タイムボーナス付与）（v0.10）
- **フェーズシャードによる共鳴ブースト**（ゲート廃止後の新収集要素）（v0.13）

### 相互次元フェーズシフト
- `Shift` キーで REALM（SOLID ↔︎ ETHER）を切り替え可能
- フェーズシフトにはエネルギーを消費（最大 5 スタック）（v0.5で上限拡張）
- フェーズごとに重力・移動速度・ジャンプ感覚が変化
- 異なる色調とプラットフォーム配置を持つ 2 つの層を行き来
- ガイド UI に現在のフェーズとエネルギー残量を表示
- フェーズ切替時に残留分身（エコー）を生成し、離れた次元に行動を残せる（v0.4）
- エコーが存在する状態で `Q` を押すと、エコーの座標へ位相移動しつつ残留地点に衝撃波を残す Echo Swap を発動可能（v0.6）
- SURGE パワーアップ中はエネルギー消費なしで Shift/Echo Swap を連発可能（v0.8）
- SURGE と STORM を同時発動すると Apex Resonance が起動し、衛星エコーが自動攻撃（v0.10）
- フェーズシャードを集めると Apex 共鳴ゲージが蓄積し、3つで自動的に共鳴発動（v0.13）

### プレイヤー
- サイズ: 32x32px の相互次元スカウト
- 操作方法:
  - 左右移動: ←→キー（SOLID: 5 / ETHER: 6.2）
  - ジャンプ: スペースキー
  - フェーズシフト: Shift キー
- フェーズに応じたビジュアル（SOLID: トマトカラー, ETHER: ネオンアクア）
- フェーズの余韻を残す残像エフェクト
- SURGE 効果中は移動速度と跳躍力が上昇し、STORM 効果中はエコーが増殖（v0.8）

### プラットフォーム
- SOLID/ETHER それぞれ固有のレイアウトを保持
- プラットフォームはフェーズごとに色/影を変化
- 非アクティブなフェーズの足場は幽体として表示（ビジュアルヒント）
- 地面（画面下部）は双方の層で共有
- SOLID のテラスと ETHER の空中足場を拡張し、フェーズ移動導線を確保（v0.4 / v0.11でゲート廃止後も継続）
- ステージ全域（3200px）に渡って配置を拡張（v0.7）
- パワーアップ導線に合わせた中盤・終盤の足場を追加（v0.8）

### フェーズエネルギーとオーブ
- 各フェーズに対応したフェーズオーブを配置
- オーブを取得するとフェーズエネルギーが回復＆リップルを発生
- 異なるフェーズではオーブが淡く幽体表示され、位置の先読みが可能
- 一定時間経過でもエネルギーが自動回復
- 次元エコーもオーブを拾ってエネルギーとコンボに貢献（v0.4）
- ステージ各所にオーブを配置し、共鳴ルートを構築（v0.4）
- Echo Swap にはエネルギーを1消費。パルスで敵を巻き込むと追加でエネルギーが供給される（v0.6）
- フェーズパワーアップ取得でエネルギーが瞬間的に補充され、効果中は各システムが強化（v0.8）
- Apex Resonance 中は衛星エコーがオーブを自動回収し、エネルギー循環が加速（v0.10）
- フェーズシャードで Apex 共鳴ゲージを追加チャージし、SURGE/STORM に頼らず共鳴を発生（v0.13）

### 敵キャラクター（v0.3 新規追加）
- フェーズごとに異なる色の敵（SOLID: 紫、ETHER: ピンク）
- プラットフォーム上をパトロール移動
- 各フェーズでのみ衝突判定が有効
- 上から踏むと倒せる（スコア＆コンボ獲得）
- 横から当たるとダメージ
- 3秒ごとに自動生成（最大6体）
- カメラ位置に応じた動的なスポーン（v0.7）
- 相互次元エコーが踏みつけて撃破可能（スコア90×コンボ、エネルギー回復）（v0.4）
- Echo Swap による位相パルスに巻き込まれると広範囲で瞬時に撃破され、スコア＆エネルギーを追加獲得（v0.6）
- STORM 効果中は追加エコー＆拡張パルスで一網打尽にできる（v0.8）
- Apex Resonance 中はフェーズを問わず衛星エコーが敵を削り、スコアとコンボが急伸（v0.10）
- フェーズシャード経由での共鳴発動により、移動ギミックに頼らず攻撃チャンスを得られる（v0.13）

### ゲームシステム（v0.3 新規追加）
- **ライフシステム**: 3ライフ制、ダメージまたは落下時に1減少（v0.7で落下ペナルティ追加）
- **無敵時間**: ダメージ後90フレーム無敵（点滅表示）
- **スコアシステム**（v0.5で視覚化強化）:
  - オーブ取得: 50点 × (コンボ + 1)
  - 敵撃破: 100点 × (コンボ + 1)
  - エコー吸収: 30点
  - エコーによる敵撃破: 90点 × (コンボ + 1)
  - すべての得点時にフローティングテキスト表示（v0.5）
  - ステージクリア時にタイムボーナス加算（v0.9）
- **コンボシステム**（v0.5で改善）:
  - オーブ取得・敵撃破でコンボ増加
  - 240フレーム（4秒）以内に次の行動がないとリセット（v0.5で延長）
  - コンボゲージで残り時間を可視化（v0.5）
  - ダメージでリセット
- **ゲームオーバー**: ライフ0で発生、Rキーでリスタート
- **ステージクリア**: ステージ終端到達でクリア画面表示、ランク評価（S/A/B/C）（v0.9）
- **全ステージクリア**: 全3ステージクリアでエンディング画面表示（v0.9）
- **ステージ進行**: Nキーで次ステージへ、Rキーでステージリスタート（v0.9）
- （v0.4 legacy）ワープゲート利用でコンボタイマー延長＆リップル演出を追加 → v0.11でシャードシステムへ移行
- Echo Swap 発動時に即座にコンボタイマーが最大化され、巻き込み撃破ごとにコンボが伸びる（v0.6）
- SURGE 発動中はコンボ維持が容易になり、Shift/Echo Swap のエネルギーコストが免除される（v0.8）
- Apex Resonance 起動でタイムボーナスを獲得し、ステージ制限時間を一時的に延長（v0.10）

### UI/デザイン
- フェーズごとに変わるグラデーション背景
- フェーズ状態/エネルギー/クールダウンを表示する HUD（v0.5でエネルギー枠5つに拡張）
- スコア・コンボ・ライフ表示（右上）
- **ステージ情報・タイマー表示**（ステージ名、経過時間、制限時間）（v0.9）
- コンボタイマーゲージの可視化（v0.5）
- 得点時のフローティングテキストフィードバック（v0.5）
- フェーズ転移時のフラッシュ＆リップルエフェクト
- ゲームオーバー画面
- **ステージクリア画面**（タイム、ランク、ボーナス表示）（v0.9）
- **全ステージクリア画面**（トータルスコア、コングラチュレーション）（v0.9）
- ゴールマーカー表示（v0.7）
- バージョン履歴ページ（changes.html）
- ワープゲートのホログラム演出（v0.4 legacy）をベースに、現在はシャード／Apex演出へ発展
- Echo Swap の準備状況をHUDへ表示し、残留地点に次元衝撃波エフェクトを描画（v0.6）
- HUD にパワーアップ残り時間ゲージを追加し、効果の可視化を強化（v0.8）

### 次元残留エコー（v0.4）
- フェーズシフト時の元フェーズに残像化した自律分身を生成
- エコーは独自に重力・プラットフォームと相互作用し、敵/オーブと衝突判定
- プレイヤーが同一フェーズに戻るとエコーを吸収しエネルギーとボーナススコアを獲得
- STORM 効果中は追加エコーが自然発生し、各フェーズで嵐のように漂う（v0.8）
- Apex Resonance 中は衛星エコーがプレイヤー周囲を周回し、敵やオーブを自動処理（v0.10）

### ピット/穴ハザード（v0.11）
- ステージに落下死の穴を複数配置
- 穴に落ちるとライフが1減少し、スタート地点に戻される
- 穴の縁は赤線で可視化
- ステージサイズに応じて動的に配置数が増加
- プレイヤーの大部分（70%以上）がピット内に入った場合のみ落下判定（v0.14で判定を緩和）

### Echo Swap（v0.6）
- `Q` キーで最寄りのエコーと位置を入れ替え、現在の位相もエコー側へシフト
- 残留地点に位相パルスを展開し、同位相にいる敵を範囲撃破してスコア/エネルギー/コンボを稼ぐ
- 残るエコーはパルスに引きずられ、新たな軌道で空間を漂う
- STORM 効果中は衝撃波半径が拡大し、チェイン殲滅が加速（v0.8）

### フェーズパワーアップ（v0.8）
- SURGE（黄金のシード）: Shift/Echo Swap のエネルギーコストを無効化し、移動速度と跳躍力を強化。効果中は自動でフェーズエネルギーが充填
- STORM（蒼い渦核）: フェーズシフト時に追加エコーを生成し続け、Echo Swap の衝撃波が拡大して敵を巻き込みやすくなる
- パワーアップはステージ各所に出現し、一定時間経過後に再出現。HUD のゲージで残り時間を確認可能
- ステージサイズに応じてパワーアップ数が動的に調整される（v0.9）

### Apex Resonance（v0.10）
- SURGE と STORM を重ね掛けすると共鳴モードが発動
- プレイヤー周囲に衛星エコーが周回し、敵を自動撃破＆オーブを回収
- 発動時にスコア＆タイムボーナス、フェーズエネルギー補充を獲得
- 衛星エコーはフェーズを跨いで攻撃し、コンボ維持を強力にサポート
- フェーズシャードによる共鳴ゲージが最大になると自動的にApex発動（v0.13）

### フェーズシャード（v0.13）
- ステージ各所に漂う結晶体を集めると Apex 共鳴ゲージが上昇
- 3個集めるとSURGE/STORMがなくてもApex Resonanceが即発動
- 衛星エコーもシャードを自動回収し、探索ルートの自由度が向上
- 取得時にフェーズエネルギーとスコアを獲得、タイムアタックでも有利

### ステージシステム（v0.9, v0.18で調整）
- **6つのステージ**:
  1. Phase Introduction（3200px / 180秒）— Aurora Steppe
  2. Echo Mastery（4000px / 210秒）— Crystal Expanse
  3. Final Dimension（5000px / 240秒）— Volcanic Rift
  4. Neon Cityscape（4500px / 220秒）— サイバーパンク都市（v0.16）
  5. Deep Ocean Trench（5500px / 260秒）— 深海海溝（v0.16）
  6. Astral Void（6000px / 280秒）— 星間終章（v0.16）
- **ステージ待機フェーズ**: 各ステージ開始時はオーバーレイで停止し、`Space` を押すとタイマーが動き出す（v0.17）
- **タイムアタック**: 各ステージに制限時間を設定（v0.9）
- **ランク評価**: クリアタイムに応じてS/A/B/Cランクを付与（v0.9）
- **タイムボーナス**: 残り時間×10点を次ステージ進行時に自動加算。最終ステージではクリア時に即時加算（v0.17）
- **動的レベル生成**: ステージ幅に応じてプラットフォーム、オーブ、パワーアップ、ピット、シャードを自動配置（v0.9, v0.11で再調整）
- **ステージ進行**: スコアとライフを引き継いで次ステージへ（v0.9）
- **全ステージクリア**: 最終ステージクリアでエンディング画面へ遷移（v0.9）

### ステージテーマ＆地形ビジュアル（v0.15, v0.16で拡張）
- **Aurora Steppe**（Stage 1）: 柔らかな段丘と極光が揺らめく草原。SOLID/ETHERで段差と導線が大きく変化
- **Crystal Expanse**（Stage 2）: 結晶尖塔と輪環が浮遊する空域。狭い足場と視差演出で空間把握を要求
- **Volcanic Rift**（Stage 3）: 噴き上がるマグマと崩落柱が連なる終局領域。ピットは灼熱の溶岩で表現
- **Neon Cityscape**（Stage 4）: ネオンが脈打つビル群とホログラム演出でスピード感のある導線を形成（v0.16）
- **Deep Ocean Trench**（Stage 5）: 潮流に揺れる珊瑚と生物発光が道を照らす深海アスレチック（v0.16）
- **Astral Void**（Stage 6）: 星雲と小惑星が舞う無重力空間でフェーズ管理が試される終章（v0.16）
- 各テーマごとにプラットフォーム陰影・ピット演出・背景パララックスを切り替え、視覚的なメリハリを演出（v0.15）
- ステージイントロでテーマ名・概要・攻略ヒントを提示し、フェーズ導線をプレイヤーと共有（v0.17）

### ステージ固有ギミック（v0.18）
- **Neon Dash Pads**（Stage 4）: ビルの稜線に沿うネオンパッドに乗ると、進行方向へハイパーブースト。連続使用はクールダウンで制御
- **Bubble Lifts**（Stage 5）: 生物発光の気泡柱が上昇気流と横流を発生。内部では重力が軽くなり、浮遊ルートが開ける
- **Gravity Wells**（Stage 6）: 星間ポケットが重力を圧縮し、周囲に軌道ドリフトを生じる。井戸内では低重力の連続ジャンプが可能
- ギミックはフェーズを問わず作用し、各テーマの攻略リズムと操作感を大きく変化させる

### UI/UX 改善（v0.17）
- ステージ開始前に「STAGE READY」オーバーレイを表示し、`Space` で開始する待機フェーズを実装
- ステージクリア時は `Space` で次ステージへ進行できるようにし、進行時に残りタイムボーナスを自動加算
- ゲームオーバー／全ステージクリア画面でも `Space` によるリスタートを受け付け、再挑戦導線を統一
- HUD のタイマー表示を新フローに合わせて調整し、待機中は経過時間が進まないように変更
- 各テーマ固有の攻略ヒントをステージイントロに追加し、初見プレイでも導線を把握しやすくした

## ファイル構成
- `index.html` - メインHTMLファイル
- `style.css` - スタイルシート
- `game.js` - ゲームロジック
- `changes.html` - バージョン履歴
- `versions/v0.1/` - v0.1のアーカイブ
- `versions/v0.2/` - v0.2のアーカイブ
- `versions/v0.3/` - v0.3のアーカイブ
- `versions/v0.4/` - v0.4のアーカイブ
- `versions/v0.5/` - v0.5のアーカイブ
- `versions/v0.6/` - v0.6のアーカイブ
- `versions/v0.7/` - v0.7のアーカイブ
- `versions/v0.8/` - v0.8のアーカイブ
- `versions/v0.9/` - v0.9のアーカイブ
- `versions/v0.10/` - v0.10のアーカイブ
- `versions/v0.11/` - v0.11のアーカイブ
- `versions/v0.12/` - v0.12のアーカイブ
- `versions/v0.13/` - v0.13のアーカイブ
- `versions/v0.14/` - v0.14のアーカイブ
- `versions/v0.15/` - v0.15のアーカイブ
- `versions/v0.16/` - v0.16のアーカイブ
- `versions/v0.17/` - v0.17のアーカイブ
- `versions/v0.18/` - v0.18のアーカイブ（最新ビルド）

## 次の実装候補（Codex へのバトンタッチ）
- Aurora/Crystal/Volcanic 向けにも軽量なギミック（風パネル、シールドスクリーン、噴火タイマー）を追加して序盤から導線を多様化
- ステージ内イベントやミニボス演出を導入し、Apex活用ルートと通常ルートを分岐させる
- タイムアタック用にゴーストリプレイ／自己ベストゴールデータを保存し、攻略研究を後押し
- テーマ別BGM・環境音・フェーズシフトSEを整備し、視覚演出と聴覚演出を同期
- クリア後に高難度「共鳴チャレンジ」モードを開放し、地形テンプレートと敵配置を再構成
